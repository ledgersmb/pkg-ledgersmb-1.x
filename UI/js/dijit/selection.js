//>>built
define("dijit/selection",["dojo/_base/array","dojo/dom","dojo/_base/lang","dojo/sniff","dojo/_base/window","dijit/focus"],function(e,t,a,r,i,d){var o=function(o){var n=o.document;this.getType=function(){if(n.getSelection){var e,t="text";try{e=o.getSelection()}catch(a){}if(e&&1==e.rangeCount){var r=e.getRangeAt(0);r.startContainer==r.endContainer&&r.endOffset-r.startOffset==1&&3!=r.startContainer.nodeType&&(t="control")}return t}return n.selection.type.toLowerCase()},this.getSelectedText=function(){if(n.getSelection){var e=o.getSelection();return e?e.toString():""}return"control"==this.getType()?null:n.selection.createRange().text},this.getSelectedHtml=function(){if(n.getSelection){var e=o.getSelection();if(e&&e.rangeCount){var t,a="";for(t=0;t<e.rangeCount;t++){var r=e.getRangeAt(t).cloneContents(),i=n.createElement("div");i.appendChild(r),a+=i.innerHTML}return a}return null}return"control"==this.getType()?null:n.selection.createRange().htmlText},this.getSelectedElement=function(){if("control"==this.getType()){if(n.getSelection){var e=o.getSelection();return e.anchorNode.childNodes[e.anchorOffset]}var t=n.selection.createRange();if(t&&t.item)return n.selection.createRange().item(0)}return null},this.getParentElement=function(){if("control"==this.getType()){var e=this.getSelectedElement();if(e)return e.parentNode}else{if(!n.getSelection){var t=n.selection.createRange();return t.collapse(!0),t.parentElement()}var a=n.getSelection();if(a){for(var r=a.anchorNode;r&&1!=r.nodeType;)r=r.parentNode;return r}}return null},this.hasAncestorElement=function(){return null!=this.getAncestorElement.apply(this,arguments)},this.getAncestorElement=function(){var e=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(e,arguments)},this.isTag=function(e,t){if(e&&e.tagName)for(var a=e.tagName.toLowerCase(),r=0;r<t.length;r++){var i=String(t[r]).toLowerCase();if(a==i)return i}return""},this.getParentOfType=function(e,t){for(;e;){if(this.isTag(e,t).length)return e;e=e.parentNode}return null},this.collapse=function(e){if(n.getSelection){var t=o.getSelection();t.removeAllRanges?e?t.collapseToStart():t.collapseToEnd():t.collapse(e)}else{var a=n.selection.createRange();a.collapse(e),a.select()}},this.remove=function(){var e=n.selection;return n.getSelection?(e=o.getSelection(),e.deleteFromDocument(),e):("none"!=e.type.toLowerCase()&&e.clear(),e)},this.selectElementChildren=function(e,a){var i;if(e=t.byId(e),n.getSelection){var d=o.getSelection();r("opera")?(i=d.rangeCount?d.getRangeAt(0):n.createRange(),i.setStart(e,0),i.setEnd(e,3==e.nodeType?e.length:e.childNodes.length),d.addRange(i)):d.selectAllChildren(e)}else if(i=e.ownerDocument.body.createTextRange(),i.moveToElementText(e),!a)try{i.select()}catch(l){}},this.selectElement=function(e,a){var d;if(e=t.byId(e),n.getSelection){var o=n.getSelection();d=n.createRange(),o.removeAllRanges&&(r("opera")&&o.getRangeAt(0)&&(d=o.getRangeAt(0)),d.selectNode(e),o.removeAllRanges(),o.addRange(d))}else try{var l=e.tagName?e.tagName.toLowerCase():"";d="img"===l||"table"===l?i.body(n).createControlRange():i.body(n).createRange(),d.addElement(e),a||d.select()}catch(s){this.selectElementChildren(e,a)}},this.inSelection=function(e){if(e){var t,a;if(n.getSelection){var r=o.getSelection();if(r&&r.rangeCount>0&&(a=r.getRangeAt(0)),a&&a.compareBoundaryPoints&&n.createRange)try{if(t=n.createRange(),t.setStart(e,0),1===a.compareBoundaryPoints(a.START_TO_END,t))return!0}catch(i){}}else{a=n.selection.createRange();try{t=e.ownerDocument.body.createTextRange(),t.moveToElementText(e)}catch(d){}if(a&&t&&1===a.compareEndPoints("EndToStart",t))return!0}}return!1},this.getBookmark=function(){var e,t,a,r=n.selection,i=d.curNode;if(n.getSelection){if(r=o.getSelection())if(r.isCollapsed){if(a=i?i.tagName:"",a&&(a=a.toLowerCase(),"textarea"==a||"input"==a&&(!i.type||"text"==i.type.toLowerCase())))return r={start:i.selectionStart,end:i.selectionEnd,node:i,pRange:!0},{isCollapsed:r.end<=r.start,mark:r};e={isCollapsed:!0},r.rangeCount&&(e.mark=r.getRangeAt(0).cloneRange())}else t=r.getRangeAt(0),e={isCollapsed:!1,mark:t.cloneRange()}}else if(r){if(a=i?i.tagName:"",a=a.toLowerCase(),i&&a&&("button"==a||"textarea"==a||"input"==a))return r.type&&"none"==r.type.toLowerCase()?{isCollapsed:!0,mark:null}:(t=r.createRange(),{isCollapsed:t.text&&t.text.length?!1:!0,mark:{range:t,pRange:!0}});e={};try{t=r.createRange(),e.isCollapsed=!("Text"==r.type?t.htmlText.length:t.length)}catch(l){return e.isCollapsed=!0,e}if("CONTROL"==r.type.toUpperCase())if(t.length){e.mark=[];for(var s=0,m=t.length;m>s;)e.mark.push(t.item(s++))}else e.isCollapsed=!0,e.mark=null;else e.mark=t.getBookmark()}return e},this.moveToBookmark=function(t){var r=t.mark;if(r)if(n.getSelection){var i=o.getSelection();if(i&&i.removeAllRanges)if(r.pRange){var d=r.node;d.selectionStart=r.start,d.selectionEnd=r.end}else i.removeAllRanges(),i.addRange(r)}else if(n.selection&&r){var l;r.pRange?l=r.range:a.isArray(r)?(l=n.body.createControlRange(),e.forEach(r,function(e){l.addElement(e)})):(l=n.body.createTextRange(),l.moveToBookmark(r)),l.select()}},this.isCollapsed=function(){return this.getBookmark().isCollapsed}},n=new o(window);return n.SelectionManager=o,n});//# sourceMappingURL=selection.js.map