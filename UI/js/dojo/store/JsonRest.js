//>>built
define("dojo/store/JsonRest",["../_base/xhr","../_base/lang","../json","../_base/declare","./util/QueryResults"],function(e,a,t,r,i){var d=null;return r("dojo.store.JsonRest",d,{constructor:function(e){this.headers={},r.safeMixin(this,e)},headers:{},target:"",idProperty:"id",ascendingPrefix:"+",descendingPrefix:"-",_getTarget:function(e){var a=this.target;return"undefined"!=typeof e&&(a+="/"==a.charAt(a.length-1)||"="==a.charAt(a.length-1)?e:"/"+e),a},get:function(t,r){r=r||{};var i=a.mixin({Accept:this.accepts},this.headers,r.headers||r);return e("GET",{url:this._getTarget(t),handleAs:"json",headers:i,timeout:r&&r.timeout})},accepts:"application/javascript, application/json",getIdentity:function(e){return e[this.idProperty]},put:function(r,i){i=i||{};var d="id"in i?i.id:this.getIdentity(r),l="undefined"!=typeof d;return e(l&&!i.incremental?"PUT":"POST",{url:this._getTarget(d),postData:t.stringify(r),handleAs:"json",headers:a.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":i.overwrite===!0?"*":null,"If-None-Match":i.overwrite===!1?"*":null},this.headers,i.headers),timeout:i&&i.timeout})},add:function(e,a){return a=a||{},a.overwrite=!1,this.put(e,a)},remove:function(t,r){return r=r||{},e("DELETE",{url:this._getTarget(t),headers:a.mixin({},this.headers,r.headers),timeout:r&&r.timeout})},query:function(t,r){r=r||{};var d=a.mixin({Accept:this.accepts},this.headers,r.headers),l=this.target.indexOf("?")>-1;if(t=t||"",t&&"object"==typeof t&&(t=e.objectToQuery(t),t=t?(l?"&":"?")+t:""),(r.start>=0||r.count>=0)&&(d["X-Range"]="items="+(r.start||"0")+"-"+("count"in r&&1/0!=r.count?r.count+(r.start||0)-1:""),this.rangeParam?(t+=(t||l?"&":"?")+this.rangeParam+"="+d["X-Range"],l=!0):d.Range=d["X-Range"]),r&&r.sort){var o=this.sortParam;t+=(t||l?"&":"?")+(o?o+"=":"sort(");for(var n=0;n<r.sort.length;n++){var m=r.sort[n];t+=(n>0?",":"")+(m.descending?this.descendingPrefix:this.ascendingPrefix)+encodeURIComponent(m.attribute)}o||(t+=")")}var s=e("GET",{url:this.target+(t||""),handleAs:"json",headers:d,timeout:r&&r.timeout});return s.total=s.then(function(){var e=s.ioArgs.xhr.getResponseHeader("Content-Range");return e||(e=s.ioArgs.xhr.getResponseHeader("X-Content-Range")),e&&(e=e.match(/\/(.*)/))&&+e[1]}),i(s)}})});//# sourceMappingURL=JsonRest.js.map