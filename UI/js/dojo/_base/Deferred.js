//>>built
define("dojo/_base/Deferred",["./kernel","../Deferred","../promise/Promise","../errors/CancelError","../has","./lang","../when"],function(e,t,n,r,o,i,a){var s=function(){},c=Object.freeze||function(){},u=e.Deferred=function(e){function a(e){if(f)throw new Error("This deferred has already been resolved");l=e,f=!0,d()}function d(){for(var e;!e&&v;){var n=v;v=v.next,(e=n.progress==s)&&(f=!1);var r=g?n.error:n.resolved;if(o("config-useDeferredInstrumentation")&&g&&t.instrumentRejected&&t.instrumentRejected(l,!!r),r)try{var a=r(l);if(a&&"function"==typeof a.then){a.then(i.hitch(n.deferred,"resolve"),i.hitch(n.deferred,"reject"),i.hitch(n.deferred,"progress"));continue}var c=e&&void 0===a;e&&!c&&(g=a instanceof Error),n.deferred[c&&g?"reject":"resolve"](c?l:a)}catch(u){n.deferred.reject(u)}else g?n.deferred.reject(l):n.deferred.resolve(l)}}var l,f,h,p,g,m,v,y=this.promise=new n;this.isResolved=y.isResolved=function(){return 0==p},this.isRejected=y.isRejected=function(){return 1==p},this.isFulfilled=y.isFulfilled=function(){return p>=0},this.isCanceled=y.isCanceled=function(){return h},this.resolve=this.callback=function(e){this.fired=p=0,this.results=[e,null],a(e)},this.reject=this.errback=function(e){g=!0,this.fired=p=1,o("config-useDeferredInstrumentation")&&t.instrumentRejected&&t.instrumentRejected(e,!!v),a(e),this.results=[null,e]},this.progress=function(e){for(var t=v;t;){var n=t.progress;n&&n(e),t=t.next}},this.addCallbacks=function(e,t){return this.then(e,t,s),this},y.then=this.then=function(e,t,n){var r=n==s?this:new u(y.cancel),o={resolved:e,error:t,progress:n,deferred:r};return v?m=m.next=o:v=m=o,f&&d(),r.promise};var b=this;y.cancel=this.cancel=function(){if(!f){var t=e&&e(b);f||(t instanceof Error||(t=new r(t)),t.log=!1,b.reject(t))}h=!0},c(y)};return i.extend(u,{addCallback:function(){return this.addCallbacks(i.hitch.apply(e,arguments))},addErrback:function(){return this.addCallbacks(null,i.hitch.apply(e,arguments))},addBoth:function(){var t=i.hitch.apply(e,arguments);return this.addCallbacks(t,t)},fired:-1}),u.when=e.when=a,u});//# sourceMappingURL=Deferred.js.map