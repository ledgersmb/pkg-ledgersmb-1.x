//>>built
define("dijit/tree/TreeStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(e,t,a,i){return a("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(e){i.mixin(this,e),this.connects=[];var a=this.store;if(!a.getFeatures()["dojo.data.api.Identity"])throw new Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");a.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([t.after(a,"onNew",i.hitch(this,"onNewItem"),!0),t.after(a,"onDelete",i.hitch(this,"onDeleteItem"),!0),t.after(a,"onSet",i.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var e;e=this.connects.pop();)e.remove()},getRoot:function(e,t){this.root?e(this.root):this.store.fetch({query:this.query,onComplete:i.hitch(this,function(t){if(1!=t.length)throw new Error("dijit.tree.TreeStoreModel: root query returned "+t.length+" items, but must return exactly one");this.root=t[0],e(this.root)}),onError:t})},mayHaveChildren:function(t){return e.some(this.childrenAttrs,function(e){return this.store.hasAttribute(t,e)},this)},getChildren:function(t,a,r){var d=this.store;if(!d.isItemLoaded(t)){var o=i.hitch(this,arguments.callee);return void d.loadItem({item:t,onItem:function(e){o(e,a,r)},onError:r})}for(var n=[],l=0;l<this.childrenAttrs.length;l++){var s=d.getValues(t,this.childrenAttrs[l]);n=n.concat(s)}var m=0;this.deferItemLoadingUntilExpand||e.forEach(n,function(e){d.isItemLoaded(e)||m++}),0==m?a(n):e.forEach(n,function(e,t){d.isItemLoaded(e)||d.loadItem({item:e,onItem:function(e){n[t]=e,0==--m&&a(n)},onError:r})})},isItem:function(e){return this.store.isItem(e)},fetchItemByIdentity:function(e){this.store.fetchItemByIdentity(e)},getIdentity:function(e){return this.store.getIdentity(e)},getLabel:function(e){return this.labelAttr?this.store.getValue(e,this.labelAttr):this.store.getLabel(e)},newItem:function(e,t,a){var i,r={parent:t,attribute:this.childrenAttrs[0]};this.newItemIdAttr&&e[this.newItemIdAttr]?this.fetchItemByIdentity({identity:e[this.newItemIdAttr],scope:this,onItem:function(d){d?this.pasteItem(d,null,t,!0,a):(i=this.store.newItem(e,r),i&&void 0!=a&&this.pasteItem(i,t,t,!1,a))}}):(i=this.store.newItem(e,r),i&&void 0!=a&&this.pasteItem(i,t,t,!1,a))},pasteItem:function(t,a,i,r,d){var o=this.store,n=this.childrenAttrs[0];if(a&&e.forEach(this.childrenAttrs,function(i){if(o.containsValue(a,i,t)){if(!r){var d=e.filter(o.getValues(a,i),function(e){return e!=t});o.setValues(a,i,d)}n=i}}),i)if("number"==typeof d){var l=o.getValues(i,n).slice();l.splice(d,0,t),o.setValues(i,n,l)}else o.setValues(i,n,o.getValues(i,n).concat(t))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(e,t){t&&this.getChildren(t.item,i.hitch(this,function(e){this.onChildrenChange(t.item,e)}))},onDeleteItem:function(e){this.onDelete(e)},onSetItem:function(t,a){-1!=e.indexOf(this.childrenAttrs,a)?this.getChildren(t,i.hitch(this,function(e){this.onChildrenChange(t,e)})):this.onChange(t)}})});//# sourceMappingURL=TreeStoreModel.js.map