//>>built
define("dijit/_editor/range",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,a){var r={getIndex:function(e,t){for(var a,r,i=[],d=[],o=e;e!=t;){var n=0;for(a=e.parentNode;r=a.childNodes[n++];)if(r===e){--n;break}i.unshift(n),d.unshift(n-a.childNodes.length),e=a}if(i.length>0&&3==o.nodeType){for(r=o.previousSibling;r&&3==r.nodeType;)i[i.length-1]--,r=r.previousSibling;for(r=o.nextSibling;r&&3==r.nodeType;)d[d.length-1]++,r=r.nextSibling}return{o:i,r:d}},getNode:function(t,r){if(!a.isArray(t)||0==t.length)return r;var i=r;return e.every(t,function(e){return e>=0&&e<i.childNodes.length?(i=i.childNodes[e],!0):(i=null,!1)}),i},getCommonAncestor:function(e,t,a){a=a||e.ownerDocument.body;for(var r=function(e){for(var t=[];e&&(t.unshift(e),e!==a);)e=e.parentNode;return t},i=r(e),d=r(t),o=Math.min(i.length,d.length),n=i[0],l=1;o>l&&i[l]===d[l];l++)n=i[l];return n},getAncestor:function(e,t,a){for(a=a||e.ownerDocument.body;e&&e!==a;){var r=e.nodeName.toUpperCase();if(t.test(r))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,a){a=a||e.ownerDocument.body,t=t||r.BlockTagNames;for(var i,d=null;e&&e!==a;){var o=e.nodeName.toUpperCase();!d&&t.test(o)&&(d=e),!i&&/^(?:BODY|TD|TH|CAPTION)$/.test(o)&&(i=e),e=e.parentNode}return{blockNode:d,blockContainer:i||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,a){var r=!1,i=0==a;if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,a))&&(i=!0),i){var d=t;for(r=!0;d&&d!==e;){if(d.previousSibling){r=!1;break}d=d.parentNode}}return r},atEndOfContainer:function(e,t,a){var r=!1,i=a==(t.length||t.childNodes.length);if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(a))&&(i=!0),i){var d=t;for(r=!0;d&&d!==e;){if(d.nextSibling){r=!1;break}d=d.parentNode}}return r},adjacentNoneTextNode:function(e,t){for(var a=e,r=0-e.length||0,i=t?"nextSibling":"previousSibling";a&&3==a.nodeType;)r+=a.length,a=a[i];return[a,r]},create:function(e){return e=e||window,e.getSelection?e.document.createRange():new d},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var a=new i.selection(e);return t||a._getCurrentSelection(),a}};if(!window.getSelection)var i=r.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),a=e.document.selection.type.toUpperCase();return new d("CONTROL"==a?i.decomposeControlRange(t):i.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e?(this.addRange(e,!0),this.isCollapsed=e.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),a=e.item(e.length-1),i=t.parentNode,d=a.parentNode,o=r.getIndex(t,i).o[0],n=r.getIndex(a,d).o[0]+1;return[i,o,d,n]},getEndPoint:function(t,a){var i=t.duplicate();i.collapse(!a);var d,o,n,l="EndTo"+(a?"End":"Start"),s=i.parentElement();if(s.childNodes.length>0?e.every(s.childNodes,function(e,a){var m;if(3!=e.nodeType){if(i.moveToElementText(e),i.compareEndPoints(l,t)>0){if(!n||3!=n.nodeType)return d=s,o=a,!1;d=n,m=!0}else if(a==s.childNodes.length-1)return d=s,o=s.childNodes.length,!1}else a==s.childNodes.length-1&&(d=e,m=!0);if(m&&d){var f=r.adjacentNoneTextNode(d)[0];d=f?f.nextSibling:s.firstChild;var u=r.adjacentNoneTextNode(d);f=u[0];var y=u[1];return f?(i.moveToElementText(f),i.collapse(!1)):i.moveToElementText(s),i.setEndPoint(l,t),o=i.text.length-y,!1}return n=e,!0}):(d=s,o=0),!a&&1==d.nodeType&&o==d.childNodes.length){var m=d.nextSibling;m&&3==m.nodeType&&(d=m,o=0)}return[d,o]},setEndPoint:function(e,t,a){var i,d,o=e.duplicate();if(3!=t.nodeType)if(a>0){if(i=t.childNodes[a-1])if(3==i.nodeType)t=i,a=i.length;else if(i.nextSibling&&3==i.nextSibling.nodeType)t=i.nextSibling,a=0;else{o.moveToElementText(i.nextSibling?i:t);var n=i.parentNode,l=n.insertBefore(i.ownerDocument.createTextNode(" "),i.nextSibling);o.collapse(!1),n.removeChild(l)}}else o.moveToElementText(t),o.collapse(!0);if(3==t.nodeType){var s=r.adjacentNoneTextNode(t),m=s[0];d=s[1],m?(o.moveToElementText(m),o.collapse(!1),"inherit"!=m.contentEditable&&d++):(o.moveToElementText(t.parentNode),o.collapse(!0),o.move("character",1),o.move("character",-1)),a+=d,a>0&&o.move("character",a)!=a&&console.error("Error when moving!")}return o},decomposeTextRange:function(e){var t=i.getEndPoint(e),a=t[0],r=t[1],d=t[0],o=t[1];return e.htmlText.length&&(e.htmlText==e.text?o=r+e.text.length:(t=i.getEndPoint(e,!0),d=t[0],o=t[1])),[a,r,d,o]},setRange:function(e,t,a,r,d,o){var n=i.setEndPoint(e,t,a);if(e.setEndPoint("StartToStart",n),!o)var l=i.setEndPoint(e,r,d);return e.setEndPoint("EndToEnd",l||n),e}},d=r.W3CRange=t(null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?r.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer,this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t),(this.startContainer!==e||this.startOffset!=t)&&(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal():this.setEnd(e,t))},setEnd:function(e,t){t=parseInt(t),(this.endContainer!==e||this.endOffset!=t)&&(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal():this.setStart(e,t))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,a,i){var d=r.getIndex(t,t.parentNode).o;this[e](t.parentNode,d.pop()+i)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return i.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){var e=this._getIERange();e.select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e),t.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new d([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}});return a.setObject("dijit.range",r),r});//# sourceMappingURL=range.js.map