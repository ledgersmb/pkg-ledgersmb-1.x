//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom","../NodeList-manipulate"],function(e,a,t,r,i,d,l,o,n,m,s,f){function y(e,t,r){if(f.global[e])return f.global[e];if(f.global.frames[e])return f.global.frames[e];r||(n("config-useXDomain")&&!n("config-dojoBlankHtmlUrl"),r=n("config-dojoBlankHtmlUrl")||a.toUrl("dojo/resources/blank.html"));var i=s.place('<iframe id="'+e+'" name="'+e+'" src="'+r+'" onload="'+t+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',f.body());return f.global[e]=i,i}function u(e,a,t){var r=f.global.frames[e.name];r.contentWindow&&(r=r.contentWindow);try{t?r.location.replace(a):r.location=a}catch(i){}}function M(e){if(e.contentDocument)return e.contentDocument;var a=e.name;if(a){var t=f.doc.getElementsByTagName("iframe");if(e.document&&t[a].contentWindow&&t[a].contentWindow.document)return t[a].contentWindow.document;if(f.doc.frames[a]&&f.doc.frames[a].document)return f.doc.frames[a].document}return null}function v(){return s.create("form",{name:w+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},f.body())}function h(){var e;try{if(F._currentDfd||!F._dfdQueue.length)return;do e=F._currentDfd=F._dfdQueue.shift();while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&F._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(F._currentDfd=null);var a,t=e.response,i=t.options,n=e._contentToClean=[],y=m.byId(i.form),u=r.notify,M=i.data||null;if(e._legacy||"POST"!==i.method||y?"GET"===i.method&&y&&t.url.indexOf("?")>-1&&(a=t.url.slice(t.url.indexOf("?")+1),M=d.mixin(l.queryToObject(a),M)):y=e._tmpForm=v(),y){if(!e._legacy){var h=y;do h=h.parentNode;while(h&&h!==f.doc.documentElement);h||(y.style.position="absolute",y.style.left="-1000px",y.style.top="-1000px",f.body().appendChild(y)),y.name||(y.name=w+"_form")}if(M){var c=function(e,a){s.create("input",{type:"hidden",name:e,value:a},y),n.push(e)};for(var g in M){var p=M[g];if(d.isArray(p)&&p.length>1)for(var b=0;b<p.length;b++)c(g,p[b]);else{var k=o("input[name='"+g+"']",y);-1==k.indexOf()?c(g,p):k.val(p)}}}var I=y.getAttributeNode("action"),E=y.getAttributeNode("method"),G=y.getAttributeNode("target");t.url&&(e._originalAction=I?I.value:null,I?I.value=t.url:y.setAttribute("action",t.url)),e._legacy?E&&E.value||(E?E.value=i.method:y.setAttribute("method",i.method)):(e._originalMethod=E?E.value:null,E?E.value=i.method:y.setAttribute("method",i.method)),e._originalTarget=G?G.value:null,G?G.value=F._iframeName:y.setAttribute("target",F._iframeName),y.target=F._iframeName,u&&u.emit("send",t,e.promise.cancel),F._notifyStart(t),y.submit()}else{var A="";t.options.data&&(A=t.options.data,"string"!=typeof A&&(A=l.objectToQuery(A)));var z=t.url+(t.url.indexOf("?")>-1?"&":"?")+A;u&&u.emit("send",t,e.promise.cancel),F._notifyStart(t),F.setSrc(F._frame,z,!0)}}catch(j){e.reject(j)}}function c(){return!this.isFulfilled()}function g(){return!!this._finished}function p(e,a){if(!a)try{var t=e.options,r=F.doc(F._frame),l=t.handleAs;if("html"!==l){if("xml"===l)if("html"===r.documentElement.tagName.toLowerCase()){o("a",r.documentElement).orphan();var n=r.documentElement.innerText||r.documentElement.textContent;n=n.replace(/>\s+</g,"><"),e.text=d.trim(n)}else e.data=r;else e.text=r.getElementsByTagName("textarea")[0].value;i(e)}else e.data=r}catch(m){a=m}a?this.reject(a):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function b(){this._callNext()}function F(e,a,i){var d=r.parseArgs(e,r.deepCreate(I,a),!0);if(e=d.url,a=d.options,"GET"!==a.method&&"POST"!==a.method)throw new Error(a.method+" not supported by dojo/request/iframe");F._frame||(F._frame=F.create(F._iframeName,k+"();"));var l=r.deferred(d,null,c,g,p,b);return l._callNext=function(){this._calledNext||(this._calledNext=!0,F._currentDfd=null,F._fireNextRequest())},l._legacy=i,F._dfdQueue.push(l),F._fireNextRequest(),t(l),i?l:l.promise}var w=e.id.replace(/[\/\.\-]/g,"_"),k=w+"_onload";f.global[k]||(f.global[k]=function(){var e=F._currentDfd;if(!e)return void F._fireNextRequest();var a=e.response,t=a.options,r=m.byId(t.form)||e._tmpForm;if(r){for(var i=e._contentToClean,d=0;d<i.length;d++)for(var l=i[d],o=0;o<r.childNodes.length;o++){var n=r.childNodes[o];if(n.name===l){s.destroy(n);break}}e._originalAction&&r.setAttribute("action",e._originalAction),e._originalMethod&&(r.setAttribute("method",e._originalMethod),r.method=e._originalMethod),e._originalTarget&&(r.setAttribute("target",e._originalTarget),r.target=e._originalTarget)}e._tmpForm&&(s.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var I={method:"POST"};return F.create=y,F.doc=M,F.setSrc=u,F._iframeName=w+"_IoIframe",F._notifyStart=function(){},F._dfdQueue=[],F._currentDfd=null,F._fireNextRequest=h,r.addCommonMethods(F,["GET","POST"]),F});//# sourceMappingURL=iframe.js.map