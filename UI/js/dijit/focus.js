//>>built
define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(e,t,a,r,i,d,o,l,n,s,m,f,u,y,h,M,v){var c,g,p=t([f,o],{curNode:null,activeStack:[],constructor:function(){var t=l.hitch(this,function(e){a.isDescendant(this.curNode,e)&&this.set("curNode",null),a.isDescendant(this.prevNode,e)&&this.set("prevNode",null)});e.before(d,"empty",t),e.before(d,"destroy",t)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,t){var a=this,r=e.document&&e.document.body;if(r){var i=m("pointer-events")?"pointerdown":m("MSPointer")?"MSPointerDown":m("touch-events")?"mousedown, touchstart":"mousedown",d=n(e.document,i,function(e){e&&e.target&&null==e.target.parentNode||a._onTouchNode(t||e.target,"mouse")}),o=n(r,"focusin",function(e){if(e.target.tagName){var r=e.target.tagName.toLowerCase();"#document"!=r&&"body"!=r&&(h.isFocusable(e.target)?a._onFocusNode(t||e.target):a._onTouchNode(t||e.target))}}),l=n(r,"focusout",function(e){a._onBlurNode(t||e.target)});return{remove:function(){d.remove(),o.remove(),l.remove(),d=o=l=null,r=null}}}},_onBlurNode:function(){var e=(new Date).getTime();c+100>e||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(l.hitch(this,function(){this.set("prevNode",this.curNode),this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),g+100>e||(this._clearActiveWidgetsTimer=setTimeout(l.hitch(this,function(){delete this._clearActiveWidgetsTimer,this._setStack([])}),0)))},_onTouchNode:function(e,t){g=(new Date).getTime(),this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer),i.contains(e,"dijitPopup")&&(e=e.firstChild);var a=[];try{for(;e;){var d=r.get(e,"dijitPopupParent");if(d)e=M.byId(d).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===u.body())break;e=y.get(e.ownerDocument).frameElement}else{var o=e.getAttribute&&e.getAttribute("widgetId"),l=o&&M.byId(o);!l||"mouse"==t&&l.get("disabled")||a.unshift(o),e=e.parentNode}}}catch(n){}this._setStack(a,t)},_onFocusNode:function(e){e&&9!=e.nodeType&&(c=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(e),e!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",e)))},_setStack:function(e,t){var a=this.activeStack,r=a.length-1,i=e.length-1;if(e[i]!=a[r]){this.set("activeStack",e);var d,o;for(o=r;o>=0&&a[o]!=e[o];o--)d=M.byId(a[o]),d&&(d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(t),this.emit("widget-blur",d,t));for(o++;i>=o;o++)d=M.byId(e[o]),d&&(d.set("focused",!0),d._focusManager==this&&d._onFocus(t),this.emit("widget-focus",d,t))}},focus:function(e){if(e)try{e.focus()}catch(t){}}}),b=new p;s(function(){var e=b.registerWin(y.get(document));m("ie")&&n(window,"unload",function(){e&&(e.remove(),e=null)})}),v.focus=function(e){b.focus(e)};for(var w in b)/^_/.test(w)||(v.focus[w]="function"==typeof b[w]?l.hitch(b,w):b[w]);return b.watch(function(e,t,a){v.focus[e]=a}),b});//# sourceMappingURL=focus.js.map