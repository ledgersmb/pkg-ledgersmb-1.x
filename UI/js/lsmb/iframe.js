//>>built
define("lsmb/iframe",["module","require","dojo/request/watch","dojo/request/util","dojo/request/handlers","dojo/_base/lang","dojo/io-query","dojo/query","dojo/has","dojo/dom","dojo/dom-construct","dojo/cookie","dojo/_base/window","dojo/NodeList-manipulate","dojo/NodeList-dom"],function(e,t,a,i,r,d,o,n,l,s,m,u,f){function h(e,a,i){if(f.global[e])return f.global[e];if(f.global.frames[e])return f.global.frames[e];i||(l("config-useXDomain")&&!l("config-dojoBlankHtmlUrl"),i=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var r=m.place('<iframe id="'+e+'" name="'+e+'" src="'+i+'" onload="'+a+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',f.body());return f.global[e]=r,r}function y(e,t,a){var i=f.global.frames[e.name];i.contentWindow&&(i=i.contentWindow);try{a?i.location.replace(t):i.location=t}catch(r){}}function c(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var a=f.doc.getElementsByTagName("iframe");if(e.document&&a[t].contentWindow&&a[t].contentWindow.document)return a[t].contentWindow.document;if(f.doc.frames[t]&&f.doc.frames[t].document)return f.doc.frames[t].document}return null}function v(){return m.create("form",{name:F+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},f.body())}function M(){var e;try{if(k._currentDfd||!k._dfdQueue.length)return;do e=k._currentDfd=k._dfdQueue.shift();while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&k._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(k._currentDfd=null);var t,a=e.response,r=a.options,l=e._contentToClean=[],h=s.byId(r.form),y=i.notify,c=r.data||null;if(c["request.download-cookie"]=_,u(_,"requested"),e._legacy||"POST"!==r.method||h?"GET"===r.method&&h&&a.url.indexOf("?")>-1&&(t=a.url.slice(a.url.indexOf("?")+1),c=d.mixin(o.queryToObject(t),c)):h=e._tmpForm=v(),h){if(!e._legacy){var M=h;do M=M.parentNode;while(M&&M!==f.doc.documentElement);M||(h.style.position="absolute",h.style.left="-1000px",h.style.top="-1000px",f.body().appendChild(h)),h.name||(h.name=F+"_form")}if(c){var g=function(e,t){m.create("input",{type:"hidden",name:e,value:t},h),l.push(e)};for(var p in c){var b=c[p];if(d.isArray(b)&&b.length>1)for(var w=0;w<b.length;w++)g(p,b[w]);else{var I=n("input[name='"+p+"']",h);-1==I.indexOf()?g(p,b):I.val(b)}}}var j=h.getAttributeNode("action"),E=h.getAttributeNode("method"),G=h.getAttributeNode("target");a.url&&(e._originalAction=j?j.value:null,j?j.value=a.url:h.setAttribute("action",a.url)),e._legacy?E&&E.value||(E?E.value=r.method:h.setAttribute("method",r.method)):(e._originalMethod=E?E.value:null,E?E.value=r.method:h.setAttribute("method",r.method)),e._originalTarget=G?G.value:null,G?G.value=k._iframeName:h.setAttribute("target",k._iframeName),h.target=k._iframeName,y&&y.emit("send",a,e.promise.cancel),k._notifyStart(a),h.submit()}else{var A="";a.options.data&&(A=a.options.data,"string"!=typeof A&&(A=o.objectToQuery(A)));var T=a.url+(a.url.indexOf("?")>-1?"&":"?")+A;y&&y.emit("send",a,e.promise.cancel),k._notifyStart(a),k.setSrc(k._frame,T,!0)}}catch(S){e.reject(S)}}function g(){return!this.isFulfilled()}function p(){return!!this._finished||"requested"!==u(_)}function b(e,t){var a=e.options,i=s.byId(a.form)||this._tmpForm;if(i){for(var o=this._contentToClean,l=0;l<o.length;l++)for(var f=o[l],h=0;h<i.childNodes.length;h++){var y=i.childNodes[h];if(y.name===f){m.destroy(y);break}}this._originalAction&&i.setAttribute("action",this._originalAction),this._originalMethod&&(i.setAttribute("method",this._originalMethod),i.method=this._originalMethod),this._originalTarget&&(i.setAttribute("target",this._originalTarget),i.target=this._originalTarget)}if(this._tmpForm&&(m.destroy(this._tmpForm),delete this._tmpForm),!t&&"requested"===u(_))try{var c=k.doc(k._frame),v=a.handleAs;if("html"!==v){if("xml"===v)if("html"===c.documentElement.tagName.toLowerCase()){n("a",c.documentElement).orphan();var M=c.documentElement.innerText||c.documentElement.textContent;M=M.replace(/>\s+</g,"><"),e.text=d.trim(M)}else e.data=c;else e.text=c.getElementsByTagName("textarea")[0].value;r(e)}else e.data=c}catch(g){t=g}t?this.reject(t):this._finished||"requested"!==u(_)?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function w(){this._callNext()}function k(e,t,r){var d=i.parseArgs(e,i.deepCreate(j,t),!0);if(e=d.url,t=d.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");k._frame||(k._frame=k.create(k._iframeName,I+"();"));var o=i.deferred(d,null,g,p,b,w);return o._callNext=function(){this._calledNext||(this._calledNext=!0,k._currentDfd=null,k._fireNextRequest())},o._legacy=r,k._dfdQueue.push(o),k._fireNextRequest(),a(o),r?o:o.promise}var F=e.id.replace(/[\/\.\-]/g,"_"),I=F+"_onload",_="request-download."+(new Date).getTime();f.global[I]||(f.global[I]=function(){var e=k._currentDfd;return e?void(e._finished=!0):void k._fireNextRequest()});var j={method:"POST"};return k.create=h,k.doc=c,k.setSrc=y,k._iframeName=F+"_IoIframe",k._notifyStart=function(){},k._dfdQueue=[],k._currentDfd=null,k._fireNextRequest=M,i.addCommonMethods(k,["GET","POST"]),k});//# sourceMappingURL=iframe.js.map