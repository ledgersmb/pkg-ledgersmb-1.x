//>>built
define("dojo/router/RouterBase",["dojo/_base/declare","dojo/hash","dojo/topic"],function(e,a,t){function r(e,a,t){var r,i,d,l,o,n,m;if(r=this.callbackQueue,i=!1,d=!1,l={stopImmediatePropagation:function(){i=!0},preventDefault:function(){d=!0},oldPath:a,newPath:t,params:e},o=[l],e instanceof Array)o=o.concat(e);else for(var s in e)o.push(e[s]);for(n=0,m=r.length;m>n;++n)i||r[n].apply(null,o);return!d}var i;i=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};var d=e(null,{_routes:null,_routeIndex:null,_started:!1,_currentPath:"",idMatch:/:(\w[\w\d]*)/g,idReplacement:"([^\\/]+)",globMatch:/\*(\w[\w\d]*)/,globReplacement:"(.+)",constructor:function(e){this._routes=[],this._routeIndex={};for(var a in e)e.hasOwnProperty(a)&&(this[a]=e[a])},register:function(e,a){return this._registerRoute(e,a)},registerBefore:function(e,a){return this._registerRoute(e,a,!0)},go:function(e,t){var r;return"string"!=typeof e?!1:(e=i(e),r=this._handlePathChange(e),r&&a(e,t),r)},startup:function(e){if(!this._started){var r=this,i=a();this._started=!0,this._hashchangeHandle=t.subscribe("/dojo/hashchange",function(){r._handlePathChange.apply(r,arguments)}),i?this._handlePathChange(i):this.go(e,!0)}},destroy:function(){this._hashchangeHandle&&this._hashchangeHandle.remove(),this._routes=null,this._routeIndex=null},_handlePathChange:function(e){var a,t,r,i,d,l,o,n,m,s=this._routes,f=this._currentPath;if(!this._started||e===f)return o;for(o=!0,a=0,r=s.length;r>a;++a)if(d=s[a],l=d.route.exec(e)){if(d.parameterNames)for(n=d.parameterNames,m={},t=0,i=n.length;i>t;++t)m[n[t]]=l[t+1];else m=l.slice(1);o=d.fire(m,f,e)}return o&&(this._currentPath=e),o},_convertRouteToRegExp:function(e){return e=e.replace(this.idMatch,this.idReplacement),e=e.replace(this.globMatch,this.globReplacement),e="^"+e+"$",new RegExp(e)},_getParameterNames:function(e){var a,t=this.idMatch,r=this.globMatch,i=[];for(t.lastIndex=0;null!==(a=t.exec(e));)i.push(a[1]);return null!==(a=r.exec(e))&&i.push(a[1]),i.length>0?i:null},_indexRoutes:function(){var e,a,t,r,i=this._routes;for(r=this._routeIndex={},e=0,a=i.length;a>e;++e)t=i[e],r[t.route]=e},_registerRoute:function(e,a,t){var i,d,l,o,n,m=this,s=this._routes,f=this._routeIndex;return i=this._routeIndex[e],d="undefined"!=typeof i,d&&(l=s[i]),l||(l={route:e,callbackQueue:[],fire:r}),o=l.callbackQueue,"string"==typeof e&&(l.parameterNames=this._getParameterNames(e),l.route=this._convertRouteToRegExp(e)),t?o.unshift(a):o.push(a),d||(i=s.length,f[e]=i,s.push(l)),n=!1,{remove:function(){var e,t;if(!n){for(e=0,t=o.length;t>e;++e)o[e]===a&&o.splice(e,1);0===o.length&&(s.splice(i,1),m._indexRoutes()),n=!0}},register:function(a,t){return m.register(e,a,t)}}}});return d});//# sourceMappingURL=RouterBase.js.map