//>>built
define("dijit/form/_AutoCompleterMixin",["dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","./DataList","./_TextBoxMixin","./_SearchMixin"],function(e,t,a,i,r,d,o,n,l,s,m){var u=t("dijit.form._AutoCompleterMixin",m,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(e){var t=0;if("number"==typeof e.selectionStart)t=e.selectionStart;else if(n("ie")){var a=e.ownerDocument.selection.createRange().duplicate(),i=e.createTextRange();a.move("character",0),i.move("character",0);try{i.setEndPoint("EndToEnd",a),t=String(i.text).replace(/\r/g,"").length}catch(r){}}return t},_setCaretPos:function(e,t){t=parseInt(t),s.selectInputText(e,t,t)},_setDisabledAttr:function(e){this.inherited(arguments),this.domNode.setAttribute("aria-disabled",e?"true":"false")},_onKey:function(e){if(!(e.charCode>=32)){var t=e.charCode||e.keyCode;if(t!=i.ALT&&t!=i.CTRL&&t!=i.META&&t!=i.SHIFT){var a=this.dropDown,r=null;if(this._abortQuery(),this.inherited(arguments),!(e.altKey||e.ctrlKey||e.metaKey))switch(this._opened&&(r=a.getHighlightedOption()),t){case i.PAGE_DOWN:case i.DOWN_ARROW:case i.PAGE_UP:case i.UP_ARROW:this._opened&&this._announceOption(r),e.stopPropagation(),e.preventDefault();break;case i.ENTER:if(r){if(r==a.nextButton){this._nextSearch(1),e.stopPropagation(),e.preventDefault();break}if(r==a.previousButton){this._nextSearch(-1),e.stopPropagation(),e.preventDefault();break}e.stopPropagation(),e.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case i.TAB:var d=this.get("displayedValue");if(a&&(d==a._messages.previousMessage||d==a._messages.nextMessage))break;r&&this._selectOption(r);case i.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(e){var t=this.focusNode;s.selectInputText(t,t.value.length);var a=this.ignoreCase?"toLowerCase":"substr";if(0==e[a](0).indexOf(this.focusNode.value[a](0))){var i=this.autoComplete?this._getCaretPos(t):t.value.length;i+1>t.value.length&&(t.value=e,s.selectInputText(t,i))}else t.value=e,s.selectInputText(t)},_openResultList:function(e,t,a){var i=this.dropDown.getHighlightedOption();return this.dropDown.clearResultList(),e.length||0!=a.start?(this._nextSearch=this.dropDown.onPage=r.hitch(this,function(t){e.nextPage(-1!==t),this.focus()}),this.dropDown.createOptions(e,a,r.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),void("direction"in a?(a.direction?this.dropDown.highlightFirstOption():a.direction||this.dropDown.highlightLastOption(),i&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(t[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))):void this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0),this.openDropDown(),this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery(),this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var e=this.get("displayedValue"),t=this.dropDown;!t||e!=t._messages.previousMessage&&e!=t._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",e)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0),this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(e,t,a){var i="";e&&(a||(a=this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]),i=this._getValueField()!=this.searchAttr?this.store.getIdentity(e):a),this.set("value",i,t,a,e)},_announceOption:function(e){if(e){var t;if(e==this.dropDown.nextButton||e==this.dropDown.previousButton)t=e.innerHTML,this.item=void 0,this.value="";else{var i=this.dropDown.items[e.getAttribute("item")];t=(this.store._oldAPI?this.store.getValue(i,this.searchAttr):i[this.searchAttr]).toString(),this.set("item",i,!1,t)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length),this.focusNode.setAttribute("aria-activedescendant",a.get(e,"id")),this._autoCompleteText(t)}},_selectOption:function(e){this.closeDropDown(),e&&this._announceOption(e),this._setCaretPos(this.focusNode,this.focusNode.value.length),this._handleOnChange(this.value,!0),this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0,this.inherited(arguments)},_startSearch:function(e){if(!this.dropDown){var t=this.id+"_popup",a=r.isString(this.dropDownClass)?r.getObject(this.dropDownClass,!1):this.dropDownClass;this.dropDown=new a({onChange:r.hitch(this,this._selectOption),id:t,dir:this.dir,textDir:this.textDir})}this._lastInput=e,this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){if(this.inherited(arguments),!this.store&&this.srcNodeRef){var e=this.srcNodeRef;if(this.store=new l({},e),!("value"in this.params)){var t=this.item=this.store.fetchSelectedItem();if(t){var a=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(t,a):t[a]}}}},postCreate:function(){var t=d('label[for="'+this.id+'"]');t.length&&(t[0].id||(t[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",t[0].id)),this.inherited(arguments),e.after(this,"onSearch",r.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(e){var t=this.labelFunc(e,this.store),a=this.labelType;return"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(t=this.doHighlight(t,this._lastInput),a="html"),{html:"html"==a,label:t}},doHighlight:function(e,t){var a=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),i=this.queryExpr.indexOf("${0}");return t=o.escapeString(t),this._escapeHtml(e.replace(new RegExp((0==i?"^":"")+"("+t+")"+(i==this.queryExpr.length-4?"$":""),a),"￿$1￿")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'<span class="dijitComboBoxHighlightMatch">$1</span>')},_escapeHtml:function(e){return e=String(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},reset:function(){this.item=null,this.inherited(arguments)},labelFunc:function(e,t){return(t._oldAPI?t.getValue(e,this.labelAttr||this.searchAttr):e[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(e,t,a,i){this._set("item",i||null),null==e&&(e=""),this.inherited(arguments)}});return n("dojo-bidi")&&u.extend({_setTextDirAttr:function(e){this.inherited(arguments),this.dropDown&&this.dropDown._set("textDir",e)}}),u});//# sourceMappingURL=_AutoCompleterMixin.js.map