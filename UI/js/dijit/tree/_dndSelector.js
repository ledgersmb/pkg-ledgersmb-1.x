//>>built
define("dijit/tree/_dndSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/dnd/common","dojo/dom","dojo/mouse","dojo/on","dojo/touch","../a11yclick","./_dndContainer"],function(e,t,a,i,r,d,o,n,l,s,m){return t("dijit.tree._dndSelector",m,{constructor:function(){this.selection={},this.anchor=null,this.events.push(n(this.tree.domNode,l.press,i.hitch(this,"onMouseDown")),n(this.tree.domNode,l.release,i.hitch(this,"onMouseUp")),n(this.tree.domNode,l.move,i.hitch(this,"onMouseMove")),n(this.tree.domNode,s.press,i.hitch(this,"onClickPress")),n(this.tree.domNode,s.release,i.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var e=[],t=this.selection;for(var a in t)e.push(t[a]);return e},selectNone:function(){return this.setSelection([]),this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(e,t){return this.setSelection(this.getSelectedTreeNodes().concat([e])),t&&(this.anchor=e),e},removeTreeNode:function(t){var a=e.filter(this.getSelectedTreeNodes(),function(e){return!d.isDescendant(e.domNode,t.domNode)});return this.setSelection(a),t},isTreeNodeSelected:function(e){return e.id&&!!this.selection[e.id]},setSelection:function(t){var a=this.getSelectedTreeNodes();e.forEach(this._setDifference(a,t),i.hitch(this,function(e){e.setSelected(!1),this.anchor==e&&delete this.anchor,delete this.selection[e.id]})),e.forEach(this._setDifference(t,a),i.hitch(this,function(e){e.setSelected(!0),this.selection[e.id]=e})),this._updateSelectionProperties()},_setDifference:function(t,a){e.forEach(a,function(e){e.__exclude__=!0});var i=e.filter(t,function(e){return!e.__exclude__});return e.forEach(a,function(e){delete e.__exclude__}),i},_updateSelectionProperties:function(){var t=this.getSelectedTreeNodes(),a=[],i=[];e.forEach(t,function(e){var t=e.getTreePath();i.push(e),a.push(t)},this);var r=e.map(i,function(e){return e.item});this.tree._set("paths",a),this.tree._set("path",a[0]||[]),this.tree._set("selectedNodes",i),this.tree._set("selectedNode",i[0]||null),this.tree._set("selectedItems",r),this.tree._set("selectedItem",r[0]||null)},onClickPress:function(e){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(e.target,this.current))){"mousedown"==e.type&&o.isLeft(e)&&e.preventDefault();var t="keydown"==e.type?this.tree.focusedChild:this.current;if(t){var a=r.getCopyKeyState(e),i=t.id;if(!this.singular&&!e.shiftKey&&this.selection[i])return void(this._doDeselect=!0);this._doDeselect=!1,this.userSelect(t,a,e.shiftKey)}}},onClickRelease:function(e){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==e.type?this.tree.focusedChild:this.current,r.getCopyKeyState(e),e.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(e,t){if(e===t)return 0;if("sourceIndex"in document.documentElement)return e.sourceIndex-t.sourceIndex;if("compareDocumentPosition"in document.documentElement)return 2&e.compareDocumentPosition(t)?1:-1;if(document.createRange){var a=doc.createRange();a.setStartBefore(e);var i=doc.createRange();return i.setStartBefore(t),a.compareBoundaryPoints(a.END_TO_END,i)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser")},userSelect:function(e,t,a){if(this.singular)this.anchor==e&&t?this.selectNone():(this.setSelection([e]),this.anchor=e);else if(a&&this.anchor){var i,r,d=this._compareNodes(this.anchor.rowNode,e.rowNode),o=this.anchor;0>d?(i=o,r=e):(i=e,r=o);for(var n=[];i!=r;)n.push(i),i=this.tree._getNext(i);n.push(r),this.setSelection(n)}else this.selection[e.id]&&t?this.removeTreeNode(e):t?this.addTreeNode(e,!0):(this.setSelection([e]),this.anchor=e)},getItem:function(e){var t=this.selection[e];return{data:t,type:["treeNode"]}},forInSelectedItems:function(e,t){t=t||a.global;for(var i in this.selection)e.call(t,this.getItem(i),i,this)}})});//# sourceMappingURL=_dndSelector.js.map