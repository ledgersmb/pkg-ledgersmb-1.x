//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(e,t,a,r,i,d,o,l,n,s,m,f,u,y,h,M){return e("dijit._HasDropDown",M,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){this.disabled||this.readOnly||("MSPointerDown"!=e.type&&e.preventDefault(),this.own(m.once(this.ownerDocument,f.release,s.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(e){var t=this.dropDown,a=!1;if(e&&this._opened){var r=d.position(this._buttonNode,!0);if(!(e.pageX>=r.x&&e.pageX<=r.x+r.w&&e.pageY>=r.y&&e.pageY<=r.y+r.h)){for(var o=e.target;o&&!a;)i.contains(o,"dijitPopup")?a=!0:o=o.parentNode;if(a){if(o=e.target,t.onItemClick){for(var l;o&&!(l=u.byNode(o));)o=o.parentNode;l&&l.onClick&&l.getParent&&l.getParent().onItemClick(l,e)}return}}}this._opened?t.focus&&(t.autoFocus!==!1||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){t.focus(),delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(e){this._stopClickEvents&&(e.stopPropagation(),e.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";i.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(m(this._buttonNode,f.press,s.hitch(this,"_onDropDownMouseDown")),m(this._buttonNode,"click",s.hitch(this,"_onDropDownClick")),m(e,"keydown",s.hitch(this,"_onKey")),m(e,"keyup",s.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0),this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var t=this.dropDown,a=e.target;return t&&this._opened&&t.handleKey&&t.handleKey(e)===!1?(e.stopPropagation(),void e.preventDefault()):void(t&&this._opened&&e.keyCode==n.ESCAPE?(this.closeDropDown(),e.stopPropagation(),e.preventDefault()):!this._opened&&(e.keyCode==n.DOWN_ARROW||(e.keyCode==n.ENTER||e.keyCode==n.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(a.tagName||"").toLowerCase()||a.type&&"text"!==a.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,e.stopPropagation(),e.preventDefault()))}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(s.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new t,a=s.hitch(this,function(){this.openDropDown(),e.resolve(this.dropDown)});return this.isLoaded()?a():this.loadDropDown(a),e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,t=e.domNode,a=this._aroundNode||this.domNode,o=this,l=h.open({parent:this,popup:e,around:a,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){o.closeDropDown(!0)},onCancel:function(){o.closeDropDown(!0)},onClose:function(){r.set(o._popupStateNode,"popupActive",!1),i.remove(o._popupStateNode,"dijitHasDropDownOpen"),o._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&a.offsetWidth>e._popupWrapper.offsetWidth){var n=a.offsetWidth-e._popupWrapper.offsetWidth,m={w:e.domNode.offsetWidth+n};this._origStyle=t.style.cssText,s.isFunction(e.resize)?e.resize(m):d.setMarginBox(t,m),"R"==l.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-n+"px")}return r.set(this._popupStateNode,"popupActive","true"),i.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",e.id),"presentation"===t.getAttribute("role")||t.getAttribute("aria-labelledby")||t.setAttribute("aria-labelledby",this.id),l},closeDropDown:function(e){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),e&&this.focus&&this.focus(),h.close(this.dropDown),this._opened=!1),this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})});//# sourceMappingURL=_HasDropDown.js.map