//>>built
define("dojo/dnd/Container",["../_base/array","../_base/declare","../_base/kernel","../_base/lang","../_base/window","../dom","../dom-class","../dom-construct","../Evented","../has","../on","../query","../touch","./common"],function(e,a,t,r,d,i,l,o,n,m,s,f,y,M){var u=a("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(e,a){this.node=i.byId(e),a||(a={}),this.creator=a.creator||null,this.skipForm=a.skipForm,this.parent=a.dropParent&&i.byId(a.dropParent),this.map={},this.current=null,this.containerState="",l.add(this.node,"dojoDndContainer"),a&&a._skipStartup||this.startup(),this.events=[s(this.node,y.over,r.hitch(this,"onMouseOver")),s(this.node,y.out,r.hitch(this,"onMouseOut")),s(this.node,"dragstart",r.hitch(this,"onSelectStart")),s(this.node,"selectstart",r.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(e){return this.map[e]},setItem:function(e,a){this.map[e]=a},delItem:function(e){delete this.map[e]},forInItems:function(e,a){a=a||t.global;var r=this.map,d=M._empty;for(var i in r)i in d||e.call(a,r[i],i,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return f((this.allowNested?"":"> ")+".dojoDndItem",this.parent)},sync:function(){var e={};return this.getAllNodes().forEach(function(a){if(a.id){var t=this.getItem(a.id);if(t)return void(e[a.id]=t)}else a.id=M.getUniqueId();var r=a.getAttribute("dndType"),d=a.getAttribute("dndData");e[a.id]={data:d||a.innerHTML,type:r?r.split(/\s*,\s*/):["text"]}},this),this.map=e,this},insertNodes:function(e,a,t){this.parent.firstChild?a?t||(t=this.parent.firstChild):t&&(t=t.nextSibling):t=null;var r,d;if(t)for(r=0;r<e.length;++r)d=this._normalizedCreator(e[r]),this.setItem(d.node.id,{data:d.data,type:d.type}),t.parentNode.insertBefore(d.node,t);else for(r=0;r<e.length;++r)d=this._normalizedCreator(e[r]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){e.forEach(this.events,function(e){e.remove()}),this.clearItems(),this.node=this.parent=this.current=null},markupFactory:function(e,a,t){return e._skipStartup=!0,new t(a,e)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var e=this.parent.getElementsByTagName("tbody");e&&e.length&&(this.parent=e[0])}this.defaultCreator=M._defaultCreator(this.parent),this.sync()},onMouseOver:function(e){for(var a=e.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(t){a=null}a||(this._changeState("Container","Over"),this.onOverEvent()),a=this._getChildByEvent(e),this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(e){for(var a=e.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(t){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null),this._changeState("Container",""),this.onOutEvent()},onSelectStart:function(e){this.withHandles||this.skipForm&&M.isFormElement(e)||(e.stopPropagation(),e.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(e,a){var t="dojoDnd"+e,r=e.toLowerCase()+"State";l.replace(this.node,t+a,t+this[r]),this[r]=a},_addItemClass:function(e,a){l.add(e,"dojoDndItem"+a)},_removeItemClass:function(e,a){l.remove(e,"dojoDndItem"+a)},_getChildByEvent:function(e){var a=e.target;if(a)for(var t=a.parentNode;t;a=t,t=a.parentNode)if((t==this.parent||this.allowNested)&&l.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(e,a){var t=(this.creator||this.defaultCreator).call(this,e,a);return r.isArray(t.type)||(t.type=["text"]),t.node.id||(t.node.id=M.getUniqueId()),l.add(t.node,"dojoDndItem"),t}});return M._createNode=function(e){return e?function(a){return o.create(e,{innerHTML:a})}:M._createSpan},M._createTrTd=function(e){var a=o.create("tr");return o.create("td",{innerHTML:e},a),a},M._createSpan=function(e){return o.create("span",{innerHTML:e})},M._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"},M._defaultCreator=function(e){var a=e.tagName.toLowerCase(),t="tbody"==a||"thead"==a?M._createTrTd:M._createNode(M._defaultCreatorNodes[a]);return function(e,a){var d,i,l,o=e&&r.isObject(e);return o&&e.tagName&&e.nodeType&&e.getAttribute?(d=e.getAttribute("dndData")||e.innerHTML,i=e.getAttribute("dndType"),i=i?i.split(/\s*,\s*/):["text"],l=e):(d=o&&e.data?e.data:e,i=o&&e.type?e.type:["text"],l=("avatar"==a?M._createSpan:t)(String(d))),l.id||(l.id=M.getUniqueId()),{node:l,data:d,type:i}}},u});//# sourceMappingURL=Container.js.map