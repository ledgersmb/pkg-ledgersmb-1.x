//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,a,t,r,i){function d(a,i){var d=a.xhr;a.status=a.xhr.status;try{a.text=d.responseText}catch(l){}"xml"===a.options.handleAs&&(a.data=d.responseXML);var o;if(i)this.reject(i);else{try{t(a)}catch(l){o=l}r.checkStatus(d.status)?o?this.reject(o):this.resolve(a):o?(i=new e("Unable to load "+a.url+" status: "+d.status+" and an error in handleAs: transformation of response",a),this.reject(i)):(i=new e("Unable to load "+a.url+" status: "+d.status,a),this.reject(i))}}function l(e){return this.xhr.getResponseHeader(e)}function o(t,v,h){var c=i("native-formdata")&&v&&v.data&&v.data instanceof FormData,g=r.parseArgs(t,r.deepCreate(M,v),c);t=g.url,v=g.options;var p=!v.data&&"POST"!==v.method&&"PUT"!==v.method;i("ie")<=10&&(t=t.split("#")[0]);var b,F=function(){b&&b()},w=r.deferred(g,f,n,m,d,F),k=g.xhr=o._create();if(!k)return w.cancel(new e("XHR was not created")),h?w:w.promise;g.getHeader=l,s&&(b=s(k,w,g));var I="undefined"==typeof v.data?null:v.data,E=!v.sync,G=v.method;try{k.open(G,t,E,v.user||u,v.password||u),v.withCredentials&&(k.withCredentials=v.withCredentials),i("native-response-type")&&v.handleAs in y&&(k.responseType=y[v.handleAs]);var A=v.headers,z=c||p?!1:"application/x-www-form-urlencoded";if(A)for(var j in A)"content-type"===j.toLowerCase()?z=A[j]:A[j]&&k.setRequestHeader(j,A[j]);z&&z!==!1&&k.setRequestHeader("Content-Type",z),A&&"X-Requested-With"in A||k.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.notify&&r.notify.emit("send",g,w.promise.cancel),k.send(I)}catch(Q){w.reject(Q)}return a(w),k=null,h?w:w.promise}i.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),i.add("dojo-force-activex-xhr",function(){return i("activex")&&"file:"===window.location.protocol}),i.add("native-xhr2",function(){if(i("native-xhr")&&!i("dojo-force-activex-xhr")){var e=new XMLHttpRequest;return"undefined"!=typeof e.addEventListener&&("undefined"==typeof opera||"undefined"!=typeof e.upload)}}),i.add("native-formdata",function(){return"undefined"!=typeof FormData}),i.add("native-response-type",function(){return i("native-xhr")&&"undefined"!=typeof(new XMLHttpRequest).responseType}),i.add("native-xhr2-blob",function(){if(i("native-response-type")){var e=new XMLHttpRequest;e.open("GET","https://dojotoolkit.org/",!0),e.responseType="blob";var a=e.responseType;return e.abort(),"blob"===a}});var n,m,s,f,y={blob:i("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};i("native-xhr2")?(n=function(){return!this.isFulfilled()},f=function(e,a){a.xhr.abort()},s=function(a,t,r){function i(){t.handleResponse(r)}function d(a){var i=a.target,d=new e("Unable to load "+r.url+" status: "+i.status,r);t.handleResponse(r,d)}function l(e){e.lengthComputable?(r.loaded=e.loaded,r.total=e.total,t.progress(r)):3===r.xhr.readyState&&(r.loaded="loaded"in e?e.loaded:e.position,t.progress(r))}return a.addEventListener("load",i,!1),a.addEventListener("error",d,!1),a.addEventListener("progress",l,!1),function(){a.removeEventListener("load",i,!1),a.removeEventListener("error",d,!1),a.removeEventListener("progress",l,!1),a=null}}):(n=function(e){return e.xhr.readyState},m=function(e){return 4===e.xhr.readyState},f=function(e,a){var t=a.xhr,r=typeof t.abort;("function"===r||"object"===r||"unknown"===r)&&t.abort()});var u,M={data:null,query:null,sync:!1,method:"GET"};if(o._create=function(){throw new Error("XMLHTTP not available")},i("native-xhr")&&!i("dojo-force-activex-xhr"))o._create=function(){return new XMLHttpRequest};else if(i("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),o._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(v){try{new ActiveXObject("Microsoft.XMLHTTP"),o._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(v){}}return r.addCommonMethods(o),o});//# sourceMappingURL=xhr.js.map