//>>built
define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,a,t,r){function i(e,a,t){if(!e||e.log!==!1){var r="";e&&e.stack&&(r+=e.stack),a&&a.stack&&(r+="\n    ----------------------------------------\n    rejected"+a.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),t&&t.stack&&(r+="\n    ----------------------------------------\n"+t.stack),console.error(e,r)}}function d(e,a,t,r){a||i(e,t,r)}function l(e,a,t,i){r.some(n,function(t){return t.error===e?(a&&(t.handled=!0),!0):void 0})||n.push({error:e,rejection:t,handled:a,deferred:i,timestamp:(new Date).getTime()}),m||(m=setTimeout(o,s))}function o(){var e=(new Date).getTime(),a=e-s;n=r.filter(n,function(e){return e.timestamp<a?(e.handled||i(e.error,e.rejection,e.deferred),!1):!0}),m=n.length?setTimeout(o,n[0].timestamp+s-e):!1}a.add("config-useDeferredInstrumentation","report-unhandled-rejections");var n=[],m=!1,s=1e3;return function(r){var i=a("config-useDeferredInstrumentation");if(i){e.on("resolved",t.hitch(console,"log","resolved")),e.on("rejected",t.hitch(console,"log","rejected")),e.on("progress",t.hitch(console,"log","progress"));var o=[];if("string"==typeof i&&(o=i.split(","),i=o.shift()),"report-rejections"===i)r.instrumentRejected=d;else{if("report-unhandled-rejections"!==i&&i!==!0&&1!==i)throw new Error("Unsupported instrumentation usage <"+i+">");r.instrumentRejected=l,s=parseInt(o[0],10)||s}}}});//# sourceMappingURL=instrumentation.js.map